!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([function(t,e){!function(){t.exports=this.wp.element}()},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,n){var o;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var t=[],e=0;e<arguments.length;e++){var o=arguments[e];if(o){var i=typeof o;if("string"===i||"number"===i)t.push(o);else if(Array.isArray(o)&&o.length){var s=r.apply(null,o);s&&t.push(s)}else if("object"===i)for(var a in o)n.call(o,a)&&o[a]&&t.push(a)}}return t.join(" ")}t.exports?(r.default=r,t.exports=r):void 0===(o=function(){return r}.apply(e,[]))||(t.exports=o)}()},function(t,e,n){var o=n(12);t.exports=function(t,e){if(null==t)return{};var n,r,i=o(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}},function(t,e,n){var o=n(13),r=n(1);t.exports=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?r(t):e}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var o=n(14);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}},function(t,e){!function(){t.exports=this.lodash}()},function(t,e){function n(){return t.exports=n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},n.apply(this,arguments)}t.exports=n},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){t.exports=function(t,e){if(null==t)return{};var n,o,r={},i=Object.keys(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e){function n(e,o){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,o)}t.exports=n},function(t,e,n){"use strict";n.r(e);var o=n(3),r=n.n(o),i=n(11),s=n.n(i),a=n(4),l=n.n(a),u=n(5),c=n.n(u),p=n(6),f=n.n(p),d=n(7),h=n.n(d),g=n(1),v=n.n(g),b=n(8),m=n.n(b),y=n(0),w=n(9),k=n(10),O=n.n(k),S=wp.url,L=S.getProtocol,j=S.isValidProtocol,E=S.getAuthority,C=S.isValidAuthority,P=S.getPath,x=S.isValidPath,_=S.getQueryString,N=S.isValidQueryString,T=S.getFragment,F=S.isValidFragment,R=wp.i18n,W=R.__,A=R.sprintf;function D(t){if(!t)return!1;var e=t.trim();if(!e)return!1;if(/^\S+:/.test(e)){var n=L(e);if(!j(n))return!1;if(Object(w.startsWith)(n,"http")&&!/^https?:\/\/[^\/\s]/i.test(e))return!1;var o=E(e);if(!C(o))return!1;var r=P(e);if(r&&!x(r))return!1;var i=_(e);if(i&&!N(i))return!1;var s=T(e);if(s&&!F(s))return!1}return!(Object(w.startsWith)(e,"#")&&!F(e))}function I(t){var e=t.url,n=t.opensInNewWindow,o=t.noFollow,r=t.sponsored,i=t.text,s={type:"editorskit/link",attributes:{url:e}},a=[];if(n){var l=A(W("%s (opens in a new tab)","block-options"),i);s.attributes.target="_blank",s.attributes["aria-label"]=l,a.push("noreferrer noopener")}return o&&a.push("nofollow"),r&&a.push("sponsored"),a.length>0&&(s.attributes.rel=a.join(" ")),s}var V=wp.element.Component,U=wp.dom,K=U.getOffsetParent,M=U.getRectangleFromRange;function B(){var t=window.getSelection();if(0===t.rangeCount)return{};var e=M(t.getRangeAt(0)),n=e.top+e.height,o=e.left+e.width/2,r=K(t.anchorNode);if(r){var i=r.getBoundingClientRect();n-=i.top,o-=i.left}return{top:n,left:o}}var H=function(t){function e(){var t;return l()(this,e),(t=f()(this,h()(e).apply(this,arguments))).state={style:B()},t}return m()(e,t),c()(e,[{key:"render",value:function(){var t=this.props.children,e=this.state.style;return Object(y.createElement)("div",{className:"editor-format-toolbar__selection-position",style:e},t)}}]),e}(V),z=n(2),q=n.n(z);function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function X(t,e){var n=t["page".concat(e?"Y":"X","Offset")],o="scroll".concat(e?"Top":"Left");if("number"!=typeof n){var r=t.document;"number"!=typeof(n=r.documentElement[o])&&(n=r.body[o])}return n}function Y(t){return X(t)}function J(t){return X(t,!0)}function Z(t){var e=function(t){var e,n,o,r=t.ownerDocument,i=r.body,s=r&&r.documentElement;return n=(e=t.getBoundingClientRect()).left,o=e.top,{left:n-=s.clientLeft||i.clientLeft||0,top:o-=s.clientTop||i.clientTop||0}}(t),n=t.ownerDocument,o=n.defaultView||n.parentWindow;return e.left+=Y(o),e.top+=J(o),e}var tt,et=new RegExp("^(".concat(/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,")(?!px)[a-z%]+$"),"i"),nt=/^(top|right|bottom|left)$/;function ot(t,e){for(var n=0;n<t.length;n++)e(t[n])}function rt(t){return"border-box"===tt(t,"boxSizing")}"undefined"!=typeof window&&(tt=window.getComputedStyle?function(t,e,n){var o="",r=t.ownerDocument,i=n||r.defaultView.getComputedStyle(t,null);return i&&(o=i.getPropertyValue(e)||i[e]),o}:function(t,e){var n=t.currentStyle&&t.currentStyle[e];if(et.test(n)&&!nt.test(e)){var o=t.style,r=o.left,i=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,o.left="fontSize"===e?"1em":n||0,n=o.pixelLeft+"px",o.left=r,t.runtimeStyle.left=i}return""===n?"auto":n});var it=["margin","border","padding"];function st(t,e,n){var o,r={},i=t.style;for(o in e)e.hasOwnProperty(o)&&(r[o]=i[o],i[o]=e[o]);for(o in n.call(t),e)e.hasOwnProperty(o)&&(i[o]=r[o])}function at(t,e,n){var o,r,i,s=0;for(r=0;r<e.length;r++)if(o=e[r])for(i=0;i<n.length;i++){var a=void 0;a="border"===o?"".concat(o+n[i],"Width"):o+n[i],s+=parseFloat(tt(t,a))||0}return s}function lt(t){return null!=t&&t==t.window}var ut={};function ct(t,e,n){if(lt(t))return"width"===e?ut.viewportWidth(t):ut.viewportHeight(t);if(9===t.nodeType)return"width"===e?ut.docWidth(t):ut.docHeight(t);var o="width"===e?["Left","Right"]:["Top","Bottom"],r="width"===e?t.offsetWidth:t.offsetHeight,i=(tt(t),rt(t)),s=0;(null==r||r<=0)&&(r=void 0,(null==(s=tt(t,e))||Number(s)<0)&&(s=t.style[e]||0),s=parseFloat(s)||0),void 0===n&&(n=i?1:-1);var a=void 0!==r||i,l=r||s;if(-1===n)return a?l-at(t,["border","padding"],o):s;if(a){var u=2===n?-at(t,["border"],o):at(t,["margin"],o);return l+(1===n?0:u)}return s+at(t,it.slice(n),o)}ot(["Width","Height"],(function(t){ut["doc".concat(t)]=function(e){var n=e.document;return Math.max(n.documentElement["scroll".concat(t)],n.body["scroll".concat(t)],ut["viewport".concat(t)](n))},ut["viewport".concat(t)]=function(e){var n="client".concat(t),o=e.document,r=o.body,i=o.documentElement[n];return"CSS1Compat"===o.compatMode&&i||r&&r[n]||i}}));var pt={position:"absolute",visibility:"hidden",display:"block"};function ft(t){var e,n=arguments;return 0!==t.offsetWidth?e=ct.apply(void 0,n):st(t,pt,(function(){e=ct.apply(void 0,n)})),e}function dt(t,e,n){var o=n;if("object"!==Q(e))return void 0!==o?("number"==typeof o&&(o+="px"),void(t.style[e]=o)):tt(t,e);for(var r in e)e.hasOwnProperty(r)&&dt(t,r,e[r])}ot(["width","height"],(function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);ut["outer".concat(e)]=function(e,n){return e&&ft(e,t,n?0:1)};var n="width"===t?["Left","Right"]:["Top","Bottom"];ut[t]=function(e,o){if(void 0===o)return e&&ft(e,t,-1);if(e){tt(e);return rt(e)&&(o+=at(e,["padding","border"],n)),dt(e,t,o)}}}));var ht=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?G(n,!0).forEach((function(e){$(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({getWindow:function(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow},offset:function(t,e){if(void 0===e)return Z(t);!function(t,e){"static"===dt(t,"position")&&(t.style.position="relative");var n,o,r=Z(t),i={};for(o in e)e.hasOwnProperty(o)&&(n=parseFloat(dt(t,o))||0,i[o]=n+e[o]-r[o]);dt(t,i)}(t,e)},isWindow:lt,each:ot,css:dt,clone:function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);if(t.overflow)for(var o in t)t.hasOwnProperty(o)&&(e.overflow[o]=t.overflow[o]);return e},scrollLeft:function(t,e){if(lt(t)){if(void 0===e)return Y(t);window.scrollTo(e,J(t))}else{if(void 0===e)return t.scrollLeft;t.scrollLeft=e}},scrollTop:function(t,e){if(lt(t)){if(void 0===e)return J(t);window.scrollTo(Y(t),e)}else{if(void 0===e)return t.scrollTop;t.scrollTop=e}},viewportWidth:0,viewportHeight:0},ut);var gt=function(t,e,n){n=n||{},9===e.nodeType&&(e=ht.getWindow(e));var o=n.allowHorizontalScroll,r=n.onlyScrollIfNeeded,i=n.alignWithTop,s=n.alignWithLeft,a=n.offsetTop||0,l=n.offsetLeft||0,u=n.offsetBottom||0,c=n.offsetRight||0;o=void 0===o||o;var p,f,d,h,g,v,b,m,y,w,k=ht.isWindow(e),O=ht.offset(t),S=ht.outerHeight(t),L=ht.outerWidth(t);k?(b=e,w=ht.height(b),y=ht.width(b),m={left:ht.scrollLeft(b),top:ht.scrollTop(b)},g={left:O.left-m.left-l,top:O.top-m.top-a},v={left:O.left+L-(m.left+y)+c,top:O.top+S-(m.top+w)+u},h=m):(p=ht.offset(e),f=e.clientHeight,d=e.clientWidth,h={left:e.scrollLeft,top:e.scrollTop},g={left:O.left-(p.left+(parseFloat(ht.css(e,"borderLeftWidth"))||0))-l,top:O.top-(p.top+(parseFloat(ht.css(e,"borderTopWidth"))||0))-a},v={left:O.left+L-(p.left+d+(parseFloat(ht.css(e,"borderRightWidth"))||0))+c,top:O.top+S-(p.top+f+(parseFloat(ht.css(e,"borderBottomWidth"))||0))+u}),g.top<0||v.top>0?!0===i?ht.scrollTop(e,h.top+g.top):!1===i?ht.scrollTop(e,h.top+v.top):g.top<0?ht.scrollTop(e,h.top+g.top):ht.scrollTop(e,h.top+v.top):r||((i=void 0===i||!!i)?ht.scrollTop(e,h.top+g.top):ht.scrollTop(e,h.top+v.top)),o&&(g.left<0||v.left>0?!0===s?ht.scrollLeft(e,h.left+g.left):!1===s?ht.scrollLeft(e,h.left+v.left):g.left<0?ht.scrollLeft(e,h.left+g.left):ht.scrollLeft(e,h.left+v.left):r||((s=void 0===s||!!s)?ht.scrollLeft(e,h.left+g.left):ht.scrollLeft(e,h.left+v.left)))},vt=wp.i18n,bt=vt.__,mt=vt.sprintf,yt=vt._n,wt=wp.element,kt=wt.Component,Ot=wt.createRef,St=wp.htmlEntities.decodeEntities,Lt=wp.keycodes,jt=Lt.UP,Et=Lt.DOWN,Ct=Lt.ENTER,Pt=Lt.TAB,xt=wp.components,_t=xt.Spinner,Nt=xt.withSpokenMessages,Tt=xt.Popover,Ft=wp.compose.withInstanceId,Rt=wp.apiFetch,Wt=wp.url.addQueryArgs,At=function(t){return t.stopPropagation()},Dt=Nt(Ft(function(t){function e(t){var n,o=t.autocompleteRef;return l()(this,e),(n=f()(this,h()(e).apply(this,arguments))).onChange=n.onChange.bind(v()(n)),n.onKeyDown=n.onKeyDown.bind(v()(n)),n.autocompleteRef=o||Ot(),n.inputRef=Ot(),n.updateSuggestions=Object(w.throttle)(n.updateSuggestions.bind(v()(n)),200),n.suggestionNodes=[],n.state={posts:[],showSuggestions:!1,selectedSuggestion:null},n}return m()(e,t),c()(e,[{key:"componentDidUpdate",value:function(){var t=this,e=this.state,n=e.showSuggestions,o=e.selectedSuggestion;n&&null!==o&&!this.scrollingIntoView&&(this.scrollingIntoView=!0,gt(this.suggestionNodes[o],this.autocompleteRef.current,{onlyScrollIfNeeded:!0}),setTimeout((function(){t.scrollingIntoView=!1}),100))}},{key:"componentWillUnmount",value:function(){delete this.suggestionsRequest}},{key:"bindSuggestionNode",value:function(t){var e=this;return function(n){e.suggestionNodes[t]=n}}},{key:"updateSuggestions",value:function(t){var e=this;if(t.length<2||/^https?:/.test(t))this.setState({showSuggestions:!1,selectedSuggestion:null,loading:!1});else{this.setState({showSuggestions:!0,selectedSuggestion:null,loading:!0});var n=Rt({path:Wt("/wp/v2/search",{search:t,per_page:20,type:"post"})});n.then((function(t){e.suggestionsRequest===n&&(e.setState({posts:t,loading:!1}),t.length?e.props.debouncedSpeak(mt(yt("%d result found, use up and down arrow keys to navigate.","%d results found, use up and down arrow keys to navigate.",t.length),t.length),"assertive"):e.props.debouncedSpeak(bt("No results.","block-options"),"assertive"))})).catch((function(){e.suggestionsRequest===n&&e.setState({loading:!1})})),this.suggestionsRequest=n}}},{key:"onChange",value:function(t){var e=t.target.value;this.props.onChange(e),this.updateSuggestions(e)}},{key:"onKeyDown",value:function(t){var e=this.state,n=e.showSuggestions,o=e.selectedSuggestion,r=e.posts,i=e.loading;if(n&&r.length&&!i){var s=this.state.posts[this.state.selectedSuggestion];switch(t.keyCode){case jt:t.stopPropagation(),t.preventDefault();var a=o?o-1:r.length-1;this.setState({selectedSuggestion:a});break;case Et:t.stopPropagation(),t.preventDefault();var l=null===o||o===r.length-1?0:o+1;this.setState({selectedSuggestion:l});break;case Pt:null!==this.state.selectedSuggestion&&(this.selectLink(s),this.props.speak(bt("Link selected.","block-options")));break;case Ct:null!==this.state.selectedSuggestion&&(t.stopPropagation(),this.selectLink(s))}}else switch(t.keyCode){case jt:0!==t.target.selectionStart&&(t.stopPropagation(),t.preventDefault(),t.target.setSelectionRange(0,0));break;case Et:this.props.value.length!==t.target.selectionStart&&(t.stopPropagation(),t.preventDefault(),t.target.setSelectionRange(this.props.value.length,this.props.value.length))}}},{key:"selectLink",value:function(t){this.props.onChange(t.url,t),this.setState({selectedSuggestion:null,showSuggestions:!1})}},{key:"handleOnClick",value:function(t){this.selectLink(t),this.inputRef.current.focus()}},{key:"render",value:function(){var t=this,e=this.props,n=e.value,o=void 0===n?"":n,r=e.autoFocus,i=void 0===r||r,s=e.instanceId,a=e.className,l=this.state,u=l.showSuggestions,c=l.posts,p=l.selectedSuggestion,f=l.loading;return Object(y.createElement)("div",{className:q()("editor-url-input block-editor-url-input",a)},Object(y.createElement)("input",{autoFocus:i,type:"text","aria-label":bt("URL","block-options"),required:!0,value:o,onChange:this.onChange,onInput:At,placeholder:bt("Paste URL or type to search","block-options"),onKeyDown:this.onKeyDown,role:"combobox","aria-expanded":u,"aria-autocomplete":"list","aria-owns":"editor-url-input-suggestions-".concat(s),"aria-activedescendant":null!==p?"editor-url-input-suggestion-".concat(s,"-").concat(p):void 0,ref:this.inputRef}),f&&Object(y.createElement)(_t,null),u&&!!c.length&&Object(y.createElement)(Tt,{position:"bottom",noArrow:!0,focusOnMount:!1},Object(y.createElement)("div",{className:q()("editor-url-input__suggestions","block-editor-url-input__suggestions","".concat(a,"__suggestions")),id:"editor-url-input-suggestions-".concat(s),ref:this.autocompleteRef,role:"listbox"},c.map((function(e,n){return Object(y.createElement)("button",{key:e.id,role:"option",tabIndex:"-1",id:"editor-url-input-suggestion-".concat(s,"-").concat(n),ref:t.bindSuggestionNode(n),className:q()("editor-url-input__suggestion block-editor-url-input__suggestion",{"is-selected":n===p}),onClick:function(){return t.handleOnClick(e)},"aria-selected":n===p},St(e.title)||bt("(no title)","block-options"))})))))}}]),e}(kt))),It=wp.i18n.__,Vt=wp.components.IconButton;function Ut(t){var e=t.autocompleteRef,n=t.className,o=t.onChangeInputValue,i=t.value,s=r()(t,["autocompleteRef","className","onChangeInputValue","value"]);return Object(y.createElement)("form",O()({className:q()("block-editor-url-popover__link-editor",n)},s),Object(y.createElement)(Dt,{value:i,onChange:o,autocompleteRef:e}),Object(y.createElement)(Vt,{icon:"editor-break",label:It("Apply","block-options"),type:"submit"}))}var Kt=wp.i18n.__,Mt=wp.components,Bt=Mt.ExternalLink,Ht=Mt.IconButton,zt=wp.url,qt=zt.safeDecodeURI,Qt=zt.filterURLForDisplay;function $t(t){var e=t.url,n=t.urlLabel,o=t.className,r=q()(o,"block-editor-url-popover__link-viewer-url");return e?Object(y.createElement)(Bt,{className:r,href:e},n||Qt(qt(e))):Object(y.createElement)("span",{className:r})}function Gt(t){var e=t.className,n=t.linkClassName,o=t.onEditLinkClick,i=t.url,s=t.urlLabel,a=r()(t,["className","linkClassName","onEditLinkClick","url","urlLabel"]);return Object(y.createElement)("div",O()({className:q()("block-editor-url-popover__link-viewer",e)},a),Object(y.createElement)($t,{url:i,urlLabel:s,className:n}),o&&Object(y.createElement)(Ht,{icon:"edit",label:Kt("Edit","block-options"),onClick:o}))}var Xt=wp.i18n.__,Yt=wp.element,Jt=Yt.Component,Zt=Yt.createRef,te=Yt.useMemo,ee=Yt.Fragment,ne=wp.components,oe=ne.ToggleControl,re=ne.withSpokenMessages,ie=wp.keycodes,se=ie.LEFT,ae=ie.RIGHT,le=ie.UP,ue=ie.DOWN,ce=ie.BACKSPACE,pe=ie.ENTER,fe=ie.ESCAPE,de=wp.dom.getRectangleFromRange,he=wp.url.prependHTTP,ge=wp.richText,ve=ge.create,be=ge.insert,me=ge.isCollapsed,ye=ge.applyFormat,we=ge.getTextContent,ke=ge.slice,Oe=wp.blockEditor.URLPopover,Se=function(t){return t.stopPropagation()};function Le(t,e){return t.addingLink||e.editLink}var je=function(t){var e=t.isActive,n=t.addingLink,o=t.value,i=r()(t,["isActive","addingLink","value"]),s=te((function(){var t=window.getSelection(),e=t.rangeCount>0?t.getRangeAt(0):null;if(e){if(n)return de(e);var o=e.startContainer;for(o=o.nextElementSibling||o;o.nodeType!==window.Node.ELEMENT_NODE;)o=o.parentNode;var r=o.closest("a");return r?r.getBoundingClientRect():void 0}}),[e,n,o.start,o.end]);return s?Object(y.createElement)(Oe,O()({anchorRect:s},i)):null},Ee=re(function(t){function e(){var t;return l()(this,e),(t=f()(this,h()(e).apply(this,arguments))).editLink=t.editLink.bind(v()(t)),t.submitLink=t.submitLink.bind(v()(t)),t.onKeyDown=t.onKeyDown.bind(v()(t)),t.onChangeInputValue=t.onChangeInputValue.bind(v()(t)),t.setLinkTarget=t.setLinkTarget.bind(v()(t)),t.setNoFollow=t.setNoFollow.bind(v()(t)),t.setSponsored=t.setSponsored.bind(v()(t)),t.onFocusOutside=t.onFocusOutside.bind(v()(t)),t.resetState=t.resetState.bind(v()(t)),t.autocompleteRef=Zt(),t.state={opensInNewWindow:!1,noFollow:!1,sponsored:!1,inputValue:""},t}return m()(e,t),c()(e,[{key:"onKeyDown",value:function(t){[se,ue,ae,le,ce,pe].indexOf(t.keyCode)>-1&&t.stopPropagation(),[fe].indexOf(t.keyCode)>-1&&this.resetState()}},{key:"onChangeInputValue",value:function(t){this.setState({inputValue:t})}},{key:"setLinkTarget",value:function(t){var e=this.props,n=e.activeAttributes.url,o=void 0===n?"":n,r=e.value,i=e.onChange;if(this.setState({opensInNewWindow:t}),!Le(this.props,this.state)){var s=we(ke(r));i(ye(r,I({url:o,opensInNewWindow:t,noFollow:this.state.noFollow,sponsored:this.state.sponsored,text:s})))}}},{key:"setNoFollow",value:function(t){var e=this.props,n=e.activeAttributes.url,o=void 0===n?"":n,r=e.value,i=e.onChange;if(this.setState({noFollow:t}),!Le(this.props,this.state)){var s=we(ke(r));i(ye(r,I({url:o,opensInNewWindow:this.state.opensInNewWindow,noFollow:t,sponsored:this.state.sponsored,text:s})))}}},{key:"setSponsored",value:function(t){var e=this.props,n=e.activeAttributes.url,o=void 0===n?"":n,r=e.value,i=e.onChange;if(this.setState({sponsored:t}),!Le(this.props,this.state)){var s=we(ke(r));i(ye(r,I({url:o,opensInNewWindow:this.state.opensInNewWindow,noFollow:this.state.noFollow,sponsored:t,text:s})))}}},{key:"editLink",value:function(t){this.setState({editLink:!0}),t.preventDefault()}},{key:"submitLink",value:function(t){var e=this.props,n=e.isActive,o=e.value,r=e.onChange,i=e.speak,s=this.state,a=s.inputValue,l=s.opensInNewWindow,u=he(a),c=I({url:u,opensInNewWindow:l,text:we(ke(o))});if(t.preventDefault(),me(o)&&!n){var p=ye(ve({text:u}),c,0,u.length);r(be(o,p))}else r(ye(o,c));this.resetState(),D(u)?i(Xt(n?"Link edited.":"Link inserted.","block-options"),"assertive"):i(Xt("Warning: the link has been inserted but may have errors. Please test it.","block-options"),"assertive")}},{key:"onFocusOutside",value:function(){var t=this.autocompleteRef.current;t&&t.contains(event.target)||this.resetState()}},{key:"resetState",value:function(){this.props.stopAddingLink(),this.setState({editLink:!1})}},{key:"render",value:function(){var t=this,e=this.props,n=e.isActive,o=e.activeAttributes,r=o.url,i=o.target,s=o.rel,a=e.addingLink,l=e.value;if(!n&&!a)return null;var u=this.state,c=u.inputValue,p=u.opensInNewWindow,f=u.noFollow,d=u.sponsored,h=Le(this.props,this.state);if(p||"_blank"!==i||this.setState({opensInNewWindow:!0}),"string"==typeof s){var g=s.split(" ").includes("nofollow"),v=s.split(" ").includes("sponsored");g!==f&&this.setState({noFollow:g}),v!==d&&this.setState({sponsored:v})}return Object(y.createElement)(H,{key:"".concat(l.start).concat(l.end)},Object(y.createElement)(je,{value:l,isActive:n,addingLink:a,onFocusOutside:this.onFocusOutside,onClose:function(){c||t.resetState()},focusOnMount:!!h&&"firstElement",renderSettings:function(){return Object(y.createElement)(ee,null,Object(y.createElement)(oe,{label:Xt("Open in New Tab","block-options"),checked:p,onChange:t.setLinkTarget}),Object(y.createElement)(oe,{label:Xt("No Follow","block-options"),checked:f,onChange:t.setNoFollow}),Object(y.createElement)(oe,{label:Xt("Sponsored","block-options"),checked:d,onChange:t.setSponsored}))}},h?Object(y.createElement)(Ut,{className:"editor-format-toolbar__link-container-content block-editor-format-toolbar__link-container-content",value:c,onChangeInputValue:this.onChangeInputValue,onKeyDown:this.onKeyDown,onKeyPress:Se,onSubmit:this.submitLink,autocompleteRef:this.autocompleteRef}):Object(y.createElement)(Gt,{className:"editor-format-toolbar__link-container-content block-editor-format-toolbar__link-container-content",onKeyPress:Se,url:r,onEditLinkClick:this.editLink,linkClassName:D(he(r))?void 0:"has-invalid-link"})))}}],[{key:"getDerivedStateFromProps",value:function(t,e){var n=t.activeAttributes,o=n.url,r=n.target,i=n.rel,s="_blank"===r;if(!Le(t,e)){if(o!==e.inputValue)return{inputValue:o};if(s!==e.opensInNewWindow)return{opensInNewWindow:s};if("string"==typeof i){var a=i.split(" ").includes("nofollow"),l=i.split(" ").includes("sponsored");if(a!==e.noFollow)return{noFollow:a};if(l!==e.sponsored)return{sponsored:l}}}return null}}]),e}(Jt));function Ce(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Pe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ce(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var xe=wp.i18n.__,_e=wp.element,Ne=_e.Component,Te=_e.Fragment,Fe=wp.data,Re=Fe.select,We=Fe.withSelect,Ae=Fe.dispatch,De=wp.blockEditor,Ie=De.BlockControls,Ve=De.RichTextToolbarButton,Ue=De.RichTextShortcut,Ke=wp.richText,Me=Ke.getTextContent,Be=Ke.applyFormat,He=Ke.removeFormat,ze=Ke.slice,qe=Ke.getActiveFormat,Qe=wp.url.isURL,$e=wp.components,Ge=$e.Toolbar,Xe=$e.withSpokenMessages,Ye=wp.compose,Je=Ye.compose,Ze=Ye.ifCondition,tn=xe("Add Link","block-options"),en=/^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\.[a-z]{2,63}$/i,nn=function(t){function e(){var t;return l()(this,e),(t=f()(this,h()(e).apply(this,arguments))).isEmail=t.isEmail.bind(v()(t)),t.addLink=t.addLink.bind(v()(t)),t.stopAddingLink=t.stopAddingLink.bind(v()(t)),t.onRemoveFormat=t.onRemoveFormat.bind(v()(t)),t.state={addingLink:!1},t}return m()(e,t),c()(e,[{key:"componentDidMount",value:function(){var t=Re("core/rich-text").getFormatType("core/link");t&&(t.edit=null,Ae("core/rich-text").addFormatTypes(t))}},{key:"isEmail",value:function(t){return en.test(t)}},{key:"addLink",value:function(){var t=this.props,e=t.value,n=t.onChange,o=Me(ze(e));o&&Qe(o)?n(Be(e,{type:"editorskit/link",attributes:{url:o}})):o&&this.isEmail(o)?n(Be(e,{type:"editorskit/link",attributes:{url:"mailto:".concat(o)}})):this.setState({addingLink:!0})}},{key:"stopAddingLink",value:function(){this.setState({addingLink:!1})}},{key:"onRemoveFormat",value:function(){var t=this.props,e=t.value,n=t.onChange,o=t.speak,r=e;Object(w.map)(["core/link","editorskit/link"],(function(t){r=He(r,t)})),n(Pe({},r)),o(xe("Link removed.","block-options"),"assertive")}},{key:"render",value:function(){var t=this.props,e=t.activeAttributes,n=t.onChange,o=this.props,r=o.isActive,i=o.value,s=qe(i,"core/link");if(s){s.type="editorskit/link";var a=i;a=Be(a,s),n(Pe({},a=He(a,"core/link"))),i=a,r=!0}return Object(y.createElement)(Te,null,Object(y.createElement)(Ie,null,Object(y.createElement)(Ge,{className:"editorskit-components-toolbar"},Object(y.createElement)(Ue,{type:"primary",character:"k",onUse:this.addLink}),Object(y.createElement)(Ue,{type:"primaryShift",character:"k",onUse:this.onRemoveFormat}),r&&Object(y.createElement)(Ve,{name:"link",icon:"editor-unlink",title:xe("Unlink","block-options"),onClick:this.onRemoveFormat,isActive:r,shortcutType:"primaryShift",shortcutCharacter:"k"}),!r&&Object(y.createElement)(Ve,{name:"link",icon:"admin-links",title:tn,onClick:this.addLink,isActive:r,shortcutType:"primary",shortcutCharacter:"k"}),Object(y.createElement)(Ee,{addingLink:this.state.addingLink,stopAddingLink:this.stopAddingLink,isActive:r,activeAttributes:e,value:i,onChange:n}))))}}]),e}(Ne),on=Je(We((function(){return{isDisabled:Re("core/edit-post").isFeatureActive("disableEditorsKitLinkFormats")}})),Ze((function(t){return!t.isDisabled})),Xe)(nn);n.d(e,"link",(function(){return fn}));var rn=wp.i18n.__,sn=wp.richText,an=sn.registerFormatType,ln=sn.applyFormat,un=sn.isCollapsed,cn=wp.htmlEntities.decodeEntities,pn=wp.url.isURL,fn={name:"editorskit/link",title:rn("Link","block-options"),tagName:"a",className:"ek-link",attributes:{url:"href",target:"target",rel:"rel"},__unstablePasteRule:function(t,e){var n=e.html,o=e.plainText;if(un(t))return t;var r=(n||o).replace(/<[^>]+>/g,"").trim();return pn(r)?ln(t,{type:"editorskit/link",attributes:{url:cn(r)}}):t},edit:on};[fn].forEach((function(t){var e=t.name,n=r()(t,["name"]);e&&an(e,n)}))}]);