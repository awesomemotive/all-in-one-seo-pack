var snippetTitle="",snippetDescription="",aioseopTitle="",aioseopDescription="",docTitle="",isGutenberg=aioseop_preview_snippet.isGutenberg,autogenerateDescriptions=aioseop_preview_snippet.autogenerateDescriptions,skipExcerpt=aioseop_preview_snippet.skipExcerpt;function aioseopUpdateMetabox(){snippetTitle=$("#aiosp_snippet_title"),snippetDescription=$("#aioseop_snippet_description"),aioseopTitle=$('input[name="aiosp_title"]'),aioseopDescription=$('textarea[name="aiosp_description"]'),"false"===isGutenberg?aioseopUpdateMetaboxClassicEditor():aioseopUpdateMetaboxGutenbergEditor(),aioseopTitle.on("input",function(){aioseopChangeSnippet(snippetTitle,aioseopTitle),""===aioseopTitle.val()&&aioseopChangeSnippet(snippetTitle,docTitle)}),"on"!==autogenerateDescriptions&&(snippetDescription.text(""),aioseopDescription.attr("placeholder",""))}function aioseopUpdateMetaboxClassicEditor(){docTitle=$("#title");var i=$("#excerpt");function e(){if(""===aioseopDescription.val()){if("on"!==skipExcerpt&&""!==i.val())return i=aioseopShortenDescription(aioseopStripMarkup(i)),aioseopChangeSnippet(snippetDescription,i),void aioseopChangePlaceholder(aioseopDescription,i);var e=aioseopGetDescription();snippetDescription.text(e),aioseopDescription.attr("placeholder",e)}}docTitle.on("input",function(){aioseopChangePlaceholder(aioseopTitle,docTitle),""===aioseopTitle.val()&&aioseopChangeSnippet(snippetTitle,docTitle)}),"on"===autogenerateDescriptions&&(aioseopDescription.on("input",function(){aioseopChangeSnippet(snippetDescription,aioseopDescription),e()}),i.on("input",function(){e()}),setTimeout(function(){tinymce.editors[0].on("KeyUp",function(){e()})},1e3))}function aioseopUpdateMetaboxGutenbergEditor(){function e(){if(""===aioseopDescription.val()){var e=wp.data.select("core/editor").getEditedPostAttribute("excerpt");if("on"!==skipExcerpt&&""!==e)return e=aioseopShortenDescription(aioseopStripMarkup(e)),snippetDescription.text(e),void aioseopDescription.attr("placeholder",e);var i=aioseopGetDescription();snippetDescription.text(i),aioseopDescription.attr("placeholder",i)}}window._wpLoadBlockEditor.then(function(){setTimeout(function(){(docTitle=$("#post-title-0")).on("input",function(){aioseopChangePlaceholder(aioseopTitle,docTitle),""===aioseopTitle.val()&&aioseopChangeSnippet(snippetTitle,docTitle)}),"on"===autogenerateDescriptions&&(aioseopDescription.on("input",function(){aioseopChangeSnippet(snippetDescription,aioseopDescription),e()}),wp.data.subscribe(function(){e()}))})})}function aioseopChangeSnippet(e,i){e.text(aioseopStripMarkup(i.val()))}function aioseopChangePlaceholder(e,i){e.attr("placeholder",aioseopStripMarkup(i.val()))}function aioseopGetDescription(){return aioseopShortenDescription(aioseopStripMarkup("false"===isGutenberg?$("#content_ifr").contents().find("body")[0].innerHTML:wp.data.select("core/editor").getEditedPostAttribute("content")))}function aioseopShortenDescription(e){return 160<(e=e.replace(/^(.{160}[^\s]*).*/,"$1")).length&&(e=e.trim().replace(/\w+[.!?]?$/,"")),e}function aioseopStripMarkup(e){return aioseopDecodeHtmlEntities((e=(e=e.replace(/(<[^ >][^>]*>)?/gm,"")).replace(/\s\s+/g," ")).trim())}function aioseopDecodeHtmlEntities(e){var i=document.createElement("textarea");return i.innerHTML=e,i.value}$(document).ready(function(){aioseopUpdateMetabox()});