var snippetTitle="",snippetDescription="",aioseopTitle="",aioseopDescription="",isGutenberg=aioseop_count_chars.isGutenberg,autogenerateDescriptions=aioseop_count_chars.autogenerateDescriptions,skipExcerpt=aioseop_count_chars.skipExcerpt;function aioseopUpdateMetaBoxFields(){snippetTitle=$("#aiosp_snippet_title"),snippetDescription=$("#aioseop_snippet_description"),aioseopTitle=$('input[name="aiosp_title"]'),aioseopDescription=$('textarea[name="aiosp_description"]'),"false"===isGutenberg?updateMetaBoxClassicEditor():updateMetaBoxGutenbergEditor()}function updateMetaBoxClassicEditor(){var e=$("#title"),t=$("#excerpt");e.on("input",function(){changePlaceholder(aioseopTitle,e),""===aioseopTitle.val()&&changeSnippet(snippetTitle,e)}),aioseopTitle.on("input",function(){changeSnippet(snippetTitle,aioseopTitle),""===aioseopTitle.val()&&changeSnippet(snippetTitle,e)}),aioseopDescription.on("input",function(){if(changeSnippet(snippetDescription,aioseopDescription),""===aioseopDescription.val()&&"on"===autogenerateDescriptions){if("on"!==skipExcerpt&&""!==t.val())return changeSnippet(snippetDescription,t),void changePlaceholder(aioseopDescription,t);var e=getDescription();snippetDescription.text(e),aioseopDescription.attr("placeholder",e)}}),t.on("input",function(){if(""===aioseopDescription.val()&&"on"===autogenerateDescriptions){if("on"!==skipExcerpt&&""!==t.val())return changeSnippet(snippetDescription,t),void changePlaceholder(aioseopDescription,t);var e=getDescription();snippetDescription.text(e),aioseopDescription.attr("placeholder",e)}}),setTimeout(function(){tinymce.editors[0].on("KeyUp",function(){if(""===aioseopDescription.val()&&"on"===autogenerateDescriptions){if("on"!==skipExcerpt&&""!==t.val())return changeSnippet(snippetDescription,t),void changePlaceholder(aioseopDescription,t);var e=getDescription();snippetDescription.text(e),aioseopDescription.attr("placeholder",e)}})},1e3)}function updateMetaBoxGutenbergEditor(){window._wpLoadBlockEditor.then(function(){setTimeout(function(){var e=$("#post-title-0");e.on("input",function(){changePlaceholder(aioseopTitle,e),""===aioseopTitle.val()&&changeSnippet(snippetTitle,e)}),aioseopTitle.on("input",function(){changeSnippet(snippetTitle,aioseopTitle),""===aioseopTitle.val()&&changeSnippet(snippetTitle,e)}),aioseopDescription.on("input",function(){if(changeSnippet(snippetDescription,aioseopDescription),""===aioseopDescription.val()&&"on"===autogenerateDescriptions){var e=wp.data.select("core/editor").getEditedPostAttribute("excerpt");if("on"!==skipExcerpt&&""!==e.val())return changeSnippet(snippetDescription,e),void changePlaceholder(aioseopDescription,e);var t=getDescription();snippetDescription.text(t),aioseopDescription.attr("placeholder",t)}}),wp.data.subscribe(function(){if(""===aioseopDescription.val()&&"on"===autogenerateDescriptions){var e=wp.data.select("core/editor").getEditedPostAttribute("excerpt");if("on"!==skipExcerpt&&""!==e.val())return snippetDescription.text(e.replace(/<(?:.|\n)*?>/gm,"")),void snippetDescription.attr("placeholder",e);var t=getDescription();snippetDescription.text(t),aioseopDescription.attr("placeholder",t)}})})})}function changeSnippet(e,t){e.text(t.val().replace(/<(?:.|\n)*?>/gm,""))}function changePlaceholder(e,t){e.attr("placeholder",t.val())}function getDescription(){return decodeHtmlEntities(stripEditorMarkup("false"===isGutenberg?$("#content_ifr").contents().find("body")[0].innerHTML:wp.data.select("core/editor").getEditedPostAttribute("content")).replace(/^(.{165}[^\s]*).*/,"$1"))}function stripEditorMarkup(e){return e.replace(/<[^>]*>?/gm,"").replace(/\s\s+/g," ").trim()}function decodeHtmlEntities(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function aioseopInitCounting(){jQuery(".aioseop_count_chars").on("keyup keydown",function(){aioseopCountChars(jQuery(this).eq(0),jQuery(this).parent().find('[name="'+jQuery(this).attr("data-length-field")+'"]').eq(0))}),jQuery(".aioseop_count_chars").each(function(){aioseopCountChars(jQuery(this).eq(0),jQuery(this).parent().find('[name="'+jQuery(this).attr("data-length-field")+'"]').eq(0))})}function aioseopCountChars(e,t){var i,o=parseInt(aioseop_count_chars.aiosp_title_extra,10),n=0;"aiosp_title"===e.attr("name")&&void 0!==o&&(n=o),t.val(e.val().length+n),i=void 0!==e.attr("size")?e.attr("size"):e.attr("rows")*e.attr("cols"),(i=parseInt(i,10))<10||(t.val()>i?t.removeClass().addClass("aioseop_count_ugly"):"aiosp_title"===e.attr("name")||"aiosp_home_title"===e.attr("name")?t.val()>i-6?t.removeClass().addClass("aioseop_count_bad"):t.removeClass().addClass("aioseop_count_good"):t.val()>i-10?t.removeClass().addClass("aioseop_count_bad"):t.removeClass().addClass("aioseop_count_good"))}jQuery(document).ready(function(){aioseopUpdateMetaBoxFields(),aioseopInitCounting()});